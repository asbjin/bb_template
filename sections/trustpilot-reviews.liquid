{% comment %}
  File: sections/trustpilot-reviews.liquid
{% endcomment %}

<section class="trustpilot-reviews-section trustpilot-reviews-{{ section.id }}">
  <div class="trustpilot-reviews-container">
    <header class="trustpilot-header">
      <h2 class="trustpilot-title">
        {{ section.settings.section_title | default: 'Trustpilot reviews' }}
      </h2>

      <div class="trustpilot-rating-row">
        <span class="trustpilot-rating-label">
          {{ section.settings.rating_label | default: 'Excellent' }}
        </span>
        <span class="trustpilot-rating-score">
          {{ section.settings.rating_score | default: '4.9 / 5' }}
        </span>
        <div class="trustpilot-stars trustpilot-stars-header" aria-hidden="true">
          {% for i in (1..5) %}
            <span class="trustpilot-star-wrapper trustpilot-star-wrapper-large">
              <svg class="trustpilot-star-icon" viewBox="0 0 251 240" role="img" focusable="false">
                <path d="M125.5 186.563L49.366 224.91l14.592-84.917L.5 77.91l85.33-12.393L125.5.5l39.67 65.017L250.5 77.91l-63.458 62.083 14.592 84.917z"/>
              </svg>
            </span>
          {% endfor %}
        </div>
      </div>
    </header>

    <div class="trustpilot-slider" data-section-id="{{ section.id }}">
      <div class="trustpilot-slider-track">
        {% for block in section.blocks %}
          <div class="trustpilot-slide" data-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
            <article class="trustpilot-review-card">
              <div class="trustpilot-stars trustpilot-stars-review" aria-hidden="true">
                {% assign stars = block.settings.stars | default: 5 %}
                {% for i in (1..stars) %}
                  <span class="trustpilot-star-wrapper trustpilot-star-wrapper-medium">
                    <svg class="trustpilot-star-icon" viewBox="0 0 251 240" role="img" focusable="false">
                      <path d="M125.5 186.563L49.366 224.91l14.592-84.917L.5 77.91l85.33-12.393L125.5.5l39.67 65.017L250.5 77.91l-63.458 62.083 14.592 84.917z"/>
                    </svg>
                  </span>
                {% endfor %}
              </div>

              {% if block.settings.title != blank %}
                <h3 class="trustpilot-review-title">
                  {{ block.settings.title }}
                </h3>
              {% endif %}

              {% if block.settings.content != blank %}
                <div class="trustpilot-review-body">
                  {{ block.settings.content | newline_to_br }}
                </div>
              {% endif %}

              {% if block.settings.author != blank %}
                <div class="trustpilot-review-author">
                  {{ block.settings.author }}
                </div>
              {% endif %}
            </article>
          </div>
        {% endfor %}
      </div>

      {% if section.blocks.size > 0 %}
        <div class="trustpilot-slider-nav">
          <button class="trustpilot-arrow trustpilot-arrow-prev" type="button" aria-label="Previous review">
            ◄
          </button>

          <div class="trustpilot-dots">
            {% for block in section.blocks %}
              <button
                class="trustpilot-dot{% if forloop.first %} is-active{% endif %}"
                type="button"
                data-index="{{ forloop.index0 }}"
                aria-label="Go to review {{ forloop.index }}">
              </button>
            {% endfor %}
          </div>

          <button class="trustpilot-arrow trustpilot-arrow-next" type="button" aria-label="Next review">
            ►
          </button>
        </div>
      {% endif %}
    </div>
  </div>
</section>

<style>
  :root {
    --trustpilot-green: {{ section.settings.star_color | default: '#00B67A' }};
    --text-dark: #1C1C1C;
    --text-medium: #4A4A4A;
    --text-light: #6B6B6B;
    --bg-section: #FAFAF8;
    --bg-card: #FFFFFF;
    --border-light: #E5E5E5;
    --dot-inactive: #D9D9D9;
  }

  .trustpilot-reviews-{{ section.id }} {
    padding: 80px 16px;
    background-color: {{ section.settings.background_color | default: '#FAFAF8' }};
    box-sizing: border-box;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-reviews-container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-header {
    text-align: center;
    margin-bottom: 40px;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-title {
    margin: 0 0 15px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    font-weight: 900;
    font-size: 48px;
    line-height: 1.1;
    color: #2D2D2D;
    letter-spacing: -0.02em;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-rating-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-rating-label {
    font-size: 18px;
    color: var(--text-light);
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-rating-score {
    font-size: 22px;
    font-weight: 700;
    color: #1C1C1C;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-stars {
    display: flex;
    align-items: center;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-stars-review {
    justify-content: center;
    margin-bottom: 20px;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-star-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--trustpilot-green);
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-stars-header .trustpilot-star-wrapper-large {
    width: 28px;
    height: 28px;
    margin-right: 4px;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-stars-header .trustpilot-star-wrapper-large:last-child {
    margin-right: 0;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-stars-review .trustpilot-star-wrapper-medium {
    width: 24px;
    height: 24px;
    margin-right: 4px;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-stars-review .trustpilot-star-wrapper-medium:last-child {
    margin-right: 0;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-star-icon {
    width: 65%;
    height: 65%;
    display: block;
    color: #ffffff;
    fill: currentColor;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-slider {
    position: relative;
    overflow: hidden;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-slider-track {
    display: flex;
    transition: transform 0.5s ease;
    will-change: transform;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-slide {
    min-width: 100%;
    box-sizing: border-box;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-review-card {
    background-color: var(--bg-card);
    border-radius: 12px;
    padding: 40px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    box-sizing: border-box;
    text-align: center;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-review-title {
    margin: 0 0 25px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    font-weight: 700;
    font-size: 24px;
    line-height: 1.4;
    color: var(--text-dark);
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-review-body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    font-size: 16px;
    line-height: 1.7;
    color: var(--text-medium);
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-review-body p {
    margin: 0 0 20px;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-review-body p:last-child {
    margin-bottom: 0;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-review-body strong {
    font-weight: 700;
    color: var(--text-dark);
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-review-author {
    margin-top: 30px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    font-weight: 700;
    font-size: 18px;
    color: #2D2D2D;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-slider-nav {
    margin-top: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-arrow {
    background: transparent;
    border: none;
    padding: 0 4px;
    font-size: 32px;
    line-height: 1;
    color: #B0B0B0;
    cursor: pointer;
    transition: color 0.3s ease, transform 0.2s ease;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-arrow:hover {
    color: #2D2D2D;
    transform: translateY(-1px);
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-dots {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: var(--dot-inactive);
    border: none;
    padding: 0;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.3s ease;
  }

  .trustpilot-reviews-{{ section.id }} .trustpilot-dot.is-active {
    background-color: #2D2D2D;
    transform: scale(1.15);
  }

  @media (max-width: 767px) {
    .trustpilot-reviews-{{ section.id }} {
      padding: 50px 16px;
    }

    .trustpilot-reviews-{{ section.id }} .trustpilot-title {
      font-size: 32px;
    }

    .trustpilot-reviews-{{ section.id }} .trustpilot-review-card {
      padding: 25px;
    }

    .trustpilot-reviews-{{ section.id }} .trustpilot-review-title {
      font-size: 20px;
    }

    .trustpilot-reviews-{{ section.id }} .trustpilot-stars-header .trustpilot-star-wrapper-large {
      width: 24px;
      height: 24px;
    }

    .trustpilot-reviews-{{ section.id }} .trustpilot-stars-review .trustpilot-star-wrapper-medium {
      width: 20px;
      height: 20px;
    }
  }
</style>

<script>
  (function() {
    var sectionSelector = '.trustpilot-reviews-{{ section.id }}';
    var sectionEl = document.querySelector(sectionSelector);
    if (!sectionEl) return;

    var track = sectionEl.querySelector('.trustpilot-slider-track');
    var slides = sectionEl.querySelectorAll('.trustpilot-slide');
    var prevBtn = sectionEl.querySelector('.trustpilot-arrow-prev');
    var nextBtn = sectionEl.querySelector('.trustpilot-arrow-next');
    var dots = sectionEl.querySelectorAll('.trustpilot-dot');

    if (!slides.length) return;

    var currentIndex = 0;
    var autoplay = {{ section.settings.autoplay | default: false | json }};
    var autoplaySpeed = {{ section.settings.autoplay_speed | default: 5000 | json }};
    var autoplayTimer = null;

    function goToSlide(index) {
      currentIndex = (index + slides.length) % slides.length;
      var offset = -100 * currentIndex;
      track.style.transform = 'translateX(' + offset + '%)';

      if (dots && dots.length) {
        dots.forEach(function(dot, dotIndex) {
          if (dotIndex === currentIndex) {
            dot.classList.add('is-active');
          } else {
            dot.classList.remove('is-active');
          }
        });
      }
    }

    function nextSlide() {
      goToSlide(currentIndex + 1);
    }

    function prevSlide() {
      goToSlide(currentIndex - 1);
    }

    function startAutoplay() {
      if (!autoplay || slides.length < 2) return;
      stopAutoplay();
      autoplayTimer = setInterval(nextSlide, autoplaySpeed);
    }

    function stopAutoplay() {
      if (autoplayTimer) {
        clearInterval(autoplayTimer);
        autoplayTimer = null;
      }
    }

    function resetAutoplay() {
      if (!autoplay) return;
      startAutoplay();
    }

    if (nextBtn) {
      nextBtn.addEventListener('click', function() {
        nextSlide();
        resetAutoplay();
      });
    }

    if (prevBtn) {
      prevBtn.addEventListener('click', function() {
        prevSlide();
        resetAutoplay();
      });
    }

    if (dots && dots.length) {
      dots.forEach(function(dot) {
        dot.addEventListener('click', function() {
          var idx = parseInt(this.getAttribute('data-index'), 10) || 0;
          goToSlide(idx);
          resetAutoplay();
        });
      });
    }

    goToSlide(0);
    startAutoplay();
  })();
</script>

{% schema %}
{
  "name": "Trustpilot reviews",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section title",
      "default": "Trustpilot reviews"
    },
    {
      "type": "text",
      "id": "rating_label",
      "label": "Rating label",
      "default": "Excellent"
    },
    {
      "type": "text",
      "id": "rating_score",
      "label": "Rating score",
      "default": "4.9 / 5"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Autoplay speed (ms)",
      "min": 3000,
      "max": 8000,
      "step": 500,
      "default": 5000
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#FAFAF8"
    },
    {
      "type": "color",
      "id": "star_color",
      "label": "Star color",
      "default": "#00B67A"
    }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        {
          "type": "range",
          "id": "stars",
          "label": "Stars",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "text",
          "id": "title",
          "label": "Review title",
          "default": "Finally… Something That Helped My Daughter Feel Like Herself Again!"
        },
        {
          "type": "textarea",
          "id": "content",
          "label": "Review content",
          "default": "I was genuinely concerned about my 5-year-old daughter. She was constantly bloated, low-energy, and more irritable than usual. Nothing we tried made a real difference. She just didn't seem like herself anymore.\n\nAfter learning about the benefits of Nature's Fix ParaGuard, I decided to give it a try… and I'm so glad I did. Within just a couple of weeks, I noticed a major shift. Her bloating went down, her energy came back, and even her mood improved dramatically.\n\nHer teachers even asked me what changed. They said she was more focused, calm, and engaged at school.\n\nAs a mom, there's no better feeling than seeing your child healthy and happy again. ParaGuard is now part of our daily routine. It's made a world of difference, and I wouldn't go without it."
        },
        {
          "type": "text",
          "id": "author",
          "label": "Author name",
          "default": "Jessica J."
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "Trustpilot reviews",
      "category": "Testimonials",
      "blocks": [
        {
          "type": "review"
        },
        {
          "type": "review"
        },
        {
          "type": "review"
        }
      ]
    }
  ]
}
{% endschema %}